# Ralph Progress Log
Started: Thu Jan 23 2026

## Codebase Patterns
- Frontend located at `/frontend` directory
- Run quality checks from frontend dir: `npm run build`, `npm run typecheck`, `npm run lint`
- Format code before committing: `npm run format` (Prettier with Tailwind class sorting)
- TypeScript strict mode enabled in tsconfig.json
- Next.js App Router in `src/app/` directory
- Path alias `@/*` maps to `./src/*`
- Environment config files go in `src/config/` directory
- Tailwind v4 uses `@theme inline { }` blocks in `globals.css` for theme configuration
- Dark mode is class-based - add `.dark` class to html element to enable
- shadcn/ui components in `src/components/ui/` - use sonner for toasts (toast deprecated)
- Use `cn()` from `@/lib/utils` for conditional Tailwind classes
- Folder structure: `components/layout/` for Header/Footer, `components/shared/` for reusable, `hooks/` for custom hooks, `stores/` for Zustand, `types/` for TS types, `providers/` for context providers
- App constants in `@/lib/constants` (ENTRY_FEE_SOL, TOURNAMENT_CONFIG, SCORING, ROUTES, etc.)
- React Query provider in `@/providers/QueryProvider` - wrap app for server state management
- Solana wallet provider in `@/providers/WalletProvider` - import wallet CSS there, not in globals.css
- Backpack wallet auto-detected via Wallet Standard - no explicit adapter needed
- Zustand store in `@/stores/useAppStore` - use selector hooks for optimized re-renders
- ThemeProvider in `@/providers/ThemeProvider` - wraps app for next-themes dark mode support
- Provider wrapping order in layout: ThemeProvider > QueryProvider > WalletProvider > children
- Inter font configured via `--font-inter` CSS variable, used as `font-sans` class
- Install shadcn/ui components via: `npx shadcn@latest add <component-name> --yes`
- Use `useMounted()` hook from `@/hooks/useMounted` for hydration-safe client-only rendering

---

## 2026-01-23 - solana-wallet-connect-US-001
- What was implemented: Added LedgerWalletAdapter to the WalletProvider component
- Files changed: frontend/src/providers/WalletProvider.tsx
- **Learnings for future iterations:**
  - Wallet adapter packages were already installed; just needed to add Ledger adapter
  - The WalletProvider was already properly structured with ConnectionProvider, WalletProvider, and WalletModalProvider
  - Backpack wallet uses Wallet Standard protocol and is auto-detected - no explicit adapter needed
  - Build passes but typecheck has pre-existing errors in test mocks and .next validator - use `npm run build` as the primary check
---

## 2026-01-23 - solana-wallet-connect-US-002
- What was implemented: Network selector dropdown with Mainnet/Devnet/Testnet options
- Files changed:
  - frontend/src/config/env.ts - Added 'testnet' to SolanaNetwork type
  - frontend/src/components/shared/NetworkSelector.tsx - New component using shadcn/ui Select
  - frontend/src/providers/WalletProvider.tsx - Now uses network from Zustand store, forces reconnect via key prop
  - frontend/src/components/layout/Header.tsx - Added NetworkSelector to desktop and mobile nav
- **Learnings for future iterations:**
  - useAppStore already had selectedNetwork state with localStorage persistence via Zustand persist middleware
  - To force wallet reconnection on network change, use key prop on ConnectionProvider and WalletProvider components
  - Network selector should use useMounted() hook to avoid hydration mismatch
  - clusterApiUrl(network) returns the default RPC URL for each network
---

## 2026-01-23 - solana-wallet-connect-US-003
- What was implemented: Custom ConnectWalletButton component with shadcn/ui Dialog modal
- Files changed:
  - frontend/src/components/shared/ConnectWalletButton.tsx - New component replacing WalletMultiButton
  - frontend/src/components/layout/Header.tsx - Now uses ConnectWalletButton instead of WalletMultiButton
- **Learnings for future iterations:**
  - WalletReadyState enum: Installed, Loadable (both mean usable), NotDetected (needs install link)
  - Use `select(walletName)` from useWallet hook to programmatically select a wallet
  - Wallet adapter provides `wallet.adapter.icon` (data URL) and `wallet.adapter.url` (store link)
  - Dynamic import with `{ ssr: false }` needed for wallet components to avoid hydration mismatch
---

## 2026-01-23 - solana-wallet-connect-US-004
- What was implemented: Connected state display with truncated wallet address
- Files changed:
  - frontend/src/components/shared/ConnectWalletButton.tsx - Added truncateAddress helper and connected state rendering
- **Learnings for future iterations:**
  - Use `connected` and `publicKey` from useWallet to detect connection state
  - `publicKey.toBase58()` returns the full address string
  - Green tint with `border-green-500/50 bg-green-500/10` gives a clear visual distinction for connected state
  - Button returns early for connected state to avoid rendering the wallet selection dialog
---

## 2026-01-23 - solana-wallet-connect-US-005
- What was implemented: useSolBalance hook for fetching wallet SOL balance
- Files changed:
  - frontend/src/hooks/useSolBalance.ts - New hook to fetch and manage SOL balance state
- **Learnings for future iterations:**
  - Use `useConnection` to get the connection object for RPC calls
  - `connection.getBalance(publicKey)` returns balance in lamports
  - Use `LAMPORTS_PER_SOL` constant from `@solana/web3.js` (equals 1e9) for conversion
  - Hook dependencies on connection, publicKey, and connected trigger refetch when network changes
  - Return object should include balance, isLoading, error, and refetch for flexibility in UI consumption
---

## 2026-01-23 - solana-wallet-connect-US-006
- What was implemented: Wallet details popup with full address, balance, and disconnect button
- Files changed:
  - frontend/src/components/ui/popover.tsx - New shadcn/ui Popover component (installed via CLI)
  - frontend/src/components/shared/ConnectWalletButton.tsx - Added Popover for connected state, integrated useSolBalance
- **Learnings for future iterations:**
  - Use shadcn/ui Popover (Radix-based) for dropdowns attached to buttons - handles click-outside and Escape key automatically
  - `navigator.clipboard.writeText()` for copy-to-clipboard, wrapped in try-catch for browser support
  - Use `setCopied(true)` with `setTimeout` to show visual feedback (Check icon) for 2 seconds
  - `disconnect()` from useWallet hook to programmatically disconnect the wallet
  - Radix Popover uses `onOpenChange` prop for controlled state, no need to handle click-outside manually
---

## 2026-01-23 - solana-wallet-connect-US-007
- What was implemented: Verified disconnect functionality (already implemented in US-006)
- Files changed: None - functionality was already complete
- **Learnings for future iterations:**
  - When a story depends on UI implemented in a prior story, the functionality may already be there
  - US-006 implemented the full disconnect flow: button in popup → handleDisconnect → disconnect() → close popover
  - The conditional rendering pattern `if (connected && publicKey)` automatically handles the state transition back to "Connect Wallet"
---

